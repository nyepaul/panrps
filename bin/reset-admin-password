#!/usr/bin/env python3
"""
Reset admin password.

Usage:
  ./bin/reset-admin-password [password]

If no password is provided, you will be prompted to enter one.
"""

import sys
import os
import getpass

# Add parent directory and src to path
parent_dir = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
sys.path.insert(0, parent_dir)
sys.path.insert(0, os.path.join(parent_dir, 'src'))

from src.auth.models import User

def main():
    # Get password from command line or prompt securely
    if len(sys.argv) > 1:
        new_password = sys.argv[1]
    else:
        new_password = getpass.getpass("Enter new admin password: ")
        confirm_password = getpass.getpass("Confirm new admin password: ")

        if new_password != confirm_password:
            print("❌ Passwords do not match!")
            sys.exit(1)

        if len(new_password) < 8:
            print("❌ Password must be at least 8 characters!")
            sys.exit(1)

    # Get admin user
    admin = User.get_by_username("admin")

    if not admin:
        print("❌ Admin user not found!")
        return

    # Update password
    admin.password_hash = User.hash_password(new_password)
    admin.save()

    print("=" * 60)
    print("✅ Admin password reset successfully!")
    print("=" * 60)
    print()
    print("Credentials:")
    print(f"  Username: admin")
    print()
    print("=" * 60)
    print("IMPORTANT: Store your admin password securely!")
    print("=" * 60)

if __name__ == '__main__':
    main()
